---
{{- $imagePullSecretName := .Values.vaultCommon.imagepullsecret.name }}
{{- $imagePullType := .Values.vaultCommon.imagepullsecret.type }}
{{- $imagePullKeys := .Values.vaultCommon.imagepullsecret.keys }}
{{- $imagePullPath := .Values.vaultCommon.imagepullsecret.path }}

{{- $awsPcaSecretName := .Values.vaultCommon.awsPcaOnprem.name }}
{{- $awsPcaType := .Values.vaultCommon.awsPcaOnprem.type }}
{{- $awsPcaKeys := .Values.vaultCommon.awsPcaOnprem.keys }}
{{- $awsPcaPath := .Values.vaultCommon.awsPcaOnprem.path }}

apiVersion: spacecontroller.infoblox-cto.github.com/v1alpha1
kind: Space
metadata:
  name: {{ template "teleport.name" . }}-tls-web
  namespace: {{ .Release.Namespace }}
spec:
  path: "/certs/csp-cert"
  secretName: {{ template "teleport.name" . }}-tls-web
  secrets:
    csp: VAULT
  type: kubernetes.io/tls

---

apiVersion: spacecontroller.infoblox-cto.github.com/v1alpha1
kind: Space
metadata:
  labels:
    app: {{ template "teleport.name" . }}
  name: {{ $imagePullSecretName }}
  namespace: {{ .Release.Namespace }}
spec:
  path: {{ tpl $imagePullPath . }}
  secretName: {{ $imagePullSecretName }}
  secrets:
    {{- range $imagePullKeys }}
    {{ . }}: VAULT
    {{- end }}
  type: {{ $imagePullType }}

---

apiVersion: spacecontroller.infoblox-cto.github.com/v1alpha1
kind: Space
metadata:
  labels:
    app: {{ template "teleport.name" . }}
  name: {{ $awsPcaSecretName }}
  namespace: {{ .Release.Namespace }}
spec:
  path: {{ tpl $awsPcaPath . }}
  secretName: {{ $awsPcaSecretName }}
  secrets:
    {{- range $awsPcaKeys }}
    {{ . }}: VAULT
    {{- end }}
  type: {{ $awsPcaType }}
